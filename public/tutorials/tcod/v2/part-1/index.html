<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta property="og:title" content="Part 1 - Drawing the &#39;@&#39; symbol and moving it around" />
<meta property="og:description" content="Welcome to part 1 of this tutorial! This series will help you create your very first roguelike game, written in Python!
This tutorial is largely based off the one found on Roguebasin. Many of the design decisions were mainly to keep this tutorial in lockstep with that one (at least in terms of chapter composition and general direction). This tutorial would not have been possible without the guidance of those who wrote that tutorial, along with all the wonderful contributors to tcod and python-tcod over the years." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://rogueliketutorials.com/tutorials/tcod/v2/part-1/" /><meta property="article:section" content="tutorials" />
<meta property="article:published_time" content="2020-06-14T11:35:26-07:00" />
<meta property="article:modified_time" content="2020-06-14T11:35:26-07:00" />


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Part 1 - Drawing the &#39;@&#39; symbol and moving it around"/>
<meta name="twitter:description" content="Welcome to part 1 of this tutorial! This series will help you create your very first roguelike game, written in Python!
This tutorial is largely based off the one found on Roguebasin. Many of the design decisions were mainly to keep this tutorial in lockstep with that one (at least in terms of chapter composition and general direction). This tutorial would not have been possible without the guidance of those who wrote that tutorial, along with all the wonderful contributors to tcod and python-tcod over the years."/>



    <link rel="canonical" href="https://rogueliketutorials.com/tutorials/tcod/v2/part-1/">

    <title>
      
        Part 1 - Drawing the &#39;@&#39; symbol and moving it around | Roguelike Tutorials
      
    </title>

    
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link href="https://rogueliketutorials.com/css/style.css" rel="stylesheet">

    

    

    
  </head>
  <body>
    
      

<header class="blog-header">
    <nav class="navbar navbar-expand-md navbar-dark bg-dark">
        <a class="navbar-brand" href="/">
            Roguelike Tutorials
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false"
            aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-between" id="navbarNav">
            <ul class="navbar-nav">
                
                
                <li class="nav-item ">
                    
                        <a class="nav-link" href="/">Home</a>
                    
                </li>
                
                <li class="nav-item ">
                    
                        <a class="nav-link" href="/tutorials/tcod/2019/">TCOD Tutorial (2019)</a>
                    
                </li>
                
                <li class="nav-item ">
                    
                        <a class="nav-link" href="/tutorials/tcod/v2/">TCOD Tutorial (2020)</a>
                    
                </li>
                
                <li class="nav-item ">
                    
                        <a class="nav-link" href="/about/">About</a>
                    
                </li>
                
            </ul>
            
        </div>
    </nav>
</header>

    

    
    <div class="container">
      <div class="row">
        <div class="col-12 col-lg-8 blog-main">

          

<header>
    <h2 class="blog-post-title">
    <a class="text-dark" href="/tutorials/tcod/v2/part-1/">Part 1 - Drawing the &lsquo;@&rsquo; symbol and moving it around</a>
</h2>

    


<div class="blog-post-date text-secondary">
    
        <time datetime="2020-06-14">Jun 14, 2020</time>
    
    
</div>

    
    
    <hr>
</header>
<article class="blog-post">
    <p>Welcome to part 1 of this tutorial! This series will help you create your very first roguelike game, written in Python!</p>
<p>This tutorial is largely based off the <a href="http://www.roguebasin.com/index.php?title=Complete_Roguelike_Tutorial,_using_python%2Blibtcod">one found on Roguebasin</a>. Many of the design decisions were mainly to keep this tutorial in lockstep
with that one (at least in terms of chapter composition and general direction). This tutorial would not have been possible without the guidance of those who wrote that tutorial, along with all the wonderful contributors to tcod and python-tcod over the years.</p>
<p>This part assumes that you have either checked <a href="/tutorials/tcod/part-0">Part 0</a> and are already set up and ready to go. If not, be sure to check that page, and make sure that you&rsquo;ve got Python and TCOD installed, and a file called <code>main.py</code> created in the directory that you want to work in.</p>
<p>Assuming that you&rsquo;ve done all that, let&rsquo;s get started. Modify (or create, if you haven&rsquo;t already) the file <code>main.py</code> to look like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3"><span style="color:#75715e">#!/usr/bin/env python3</span>
<span style="color:#f92672">import</span> tcod


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>():
    print(<span style="color:#e6db74">&#34;Hello World!&#34;</span>)


<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
    main()</code></pre></div>
<p>You can run the program like any other Python program, but for those who are brand new, you do that by typing <code>python main.py</code> in the terminal. If you have both Python 2 and 3 installed on your machine, you might have to use <code>python3 main.py</code> to run (it depends on your default python, and whether you&rsquo;re using a virtualenv or not).</p>
<p>Alternatively, because of the first line, <code>#!usr/bin/env python</code>, you can run the program by typing <code>./main.py</code>, assuming you&rsquo;ve either activated your virtual environment, or installed tcod on your base Python installation. This line is called a &ldquo;shebang&rdquo;.</p>
<p>Okay, not the most exciting program in the world, I admit, but we&rsquo;ve already got our first major difference from the other tutorial. Namely, this funky looking thing here:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3"><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
    main()</code></pre></div>
<p>So what does that do? Basically, we&rsquo;re saying that we&rsquo;re only going to run the &ldquo;main&rdquo; function when we explicitly run the script, using <code>python main.py</code>. It&rsquo;s not super important that you understand this now, but if you want a more detailed explanation, <a href="https://stackoverflow.com/a/419185">this answer on Stack Overflow</a> gives a pretty good overview.</p>
<p>Confirm that the above program runs (if not, there&rsquo;s probably an issue with your tcod setup). Once that&rsquo;s done, we can move on to bigger and better things. The first major step to creating any roguelike is getting an &lsquo;@&rsquo; character on the screen and moving, so let&rsquo;s get started with that.</p>
<p>Modify <code>main.py</code> to look like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3"><span style="color:#75715e">#!/usr/bin/env python3</span>
<span style="color:#f92672">import</span> tcod


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>() <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">None</span>:
    screen_width <span style="color:#f92672">=</span> <span style="color:#ae81ff">80</span>
    screen_height <span style="color:#f92672">=</span> <span style="color:#ae81ff">50</span>

    tileset <span style="color:#f92672">=</span> tcod<span style="color:#f92672">.</span>tileset<span style="color:#f92672">.</span>load_tilesheet(
        <span style="color:#e6db74">&#34;dejavu10x10_gs_tc.png&#34;</span>, <span style="color:#ae81ff">32</span>, <span style="color:#ae81ff">8</span>, tcod<span style="color:#f92672">.</span>tileset<span style="color:#f92672">.</span>CHARMAP_TCOD
    )

    <span style="color:#66d9ef">with</span> tcod<span style="color:#f92672">.</span>context<span style="color:#f92672">.</span>new_terminal(
        screen_width,
        screen_height,
        tileset<span style="color:#f92672">=</span>tileset,
        title<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Yet Another Roguelike Tutorial&#34;</span>,
        vsync<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
    ) <span style="color:#66d9ef">as</span> context:
        root_console <span style="color:#f92672">=</span> tcod<span style="color:#f92672">.</span>Console(screen_width, screen_height, order<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;F&#34;</span>)
        <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
            root_console<span style="color:#f92672">.</span>print(x<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, y<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, string<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@&#34;</span>)

            context<span style="color:#f92672">.</span>present(root_console)

            <span style="color:#66d9ef">for</span> event <span style="color:#f92672">in</span> tcod<span style="color:#f92672">.</span>event<span style="color:#f92672">.</span>wait():
                <span style="color:#66d9ef">if</span> event<span style="color:#f92672">.</span>type <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;QUIT&#34;</span>:
                    <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">SystemExit</span>()


<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
    main()</code></pre></div>
<p>Run <code>main.py</code> again, and you should see an &lsquo;@&rsquo; symbol on the screen. Once you&rsquo;ve fully soaked in the glory on the screen in front of you, you can click the &ldquo;X&rdquo; in the top-left corner of the program to close it.</p>
<p>There&rsquo;s a lot going on here, so let&rsquo;s break it down line by line.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3">    screen_width <span style="color:#f92672">=</span> <span style="color:#ae81ff">80</span>
    screen_height <span style="color:#f92672">=</span> <span style="color:#ae81ff">50</span></code></pre></div>
<p>This is simple enough. We&rsquo;re defining some variables for the screen size.</p>
<p>Eventually, we&rsquo;ll load these values from a JSON file rather than hard coding them in the source, but we won&rsquo;t worry about that until we have some more variables like this.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3">    tileset <span style="color:#f92672">=</span> tcod<span style="color:#f92672">.</span>tileset<span style="color:#f92672">.</span>load_tilesheet(
        <span style="color:#e6db74">&#34;dejavu10x10_gs_tc.png&#34;</span>, <span style="color:#ae81ff">32</span>, <span style="color:#ae81ff">8</span>, tcod<span style="color:#f92672">.</span>tileset<span style="color:#f92672">.</span>CHARMAP_TCOD
    )</code></pre></div>
<p>Here, we&rsquo;re telling tcod which font to use. The <code>&quot;dejavu10x10_gs_tc.png&quot;</code> bit is the actual file we&rsquo;re reading from (this should exist in your project folder).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3">    <span style="color:#66d9ef">with</span> tcod<span style="color:#f92672">.</span>context<span style="color:#f92672">.</span>new_terminal(
        screen_width,
        screen_height,
        tileset<span style="color:#f92672">=</span>tileset
        title<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Yet Another Roguelike Tutorial&#34;</span>,
        vsync<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
    ) <span style="color:#66d9ef">as</span> context:</code></pre></div>
<p>This part is what actually creates the screen. We&rsquo;re giving it the <code>screen_width</code> and <code>screen_height</code> values from before (80 and 50, respectively), along with a title (change this if you&rsquo;ve already got your game&rsquo;s name figured out). <code>tileset</code> uses the tileset we defined earlier. and <code>vsync</code> will either enable or disable vsync, which shouldn&rsquo;t matter too much in our case.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3">        root_console <span style="color:#f92672">=</span> tcod<span style="color:#f92672">.</span>Console(screen_width, screen_height, order<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;F&#34;</span>)</code></pre></div>
<p>This creates our &ldquo;console&rdquo; which is what we&rsquo;ll be drawing to. We also set this console&rsquo;s width and height to the same as our new terminal. The &ldquo;order&rdquo; argument affects the order of our x and y variables in numpy (an underlying library that tcod uses). By default, numpy accesses 2D arrays in [y, x] order, which is fairly unintuitive. By setting <code>order=&quot;F&quot;</code>, we can change this to be [x, y] instead. This will make more sense once we start drawing the map.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3">        <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:</code></pre></div>
<p>This is what&rsquo;s called our &lsquo;game loop&rsquo;. Basically, this is a loop that won&rsquo;t ever end, until we close the screen. Every game has some sort of game loop or another.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3">            root_console<span style="color:#f92672">.</span>print(x<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, y<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, string<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@&#34;</span>)</code></pre></div>
<p>This line is what tells the program to actually put the &ldquo;@&rdquo; symbol on the screen in its proper place. We&rsquo;re telling the <code>root_console</code> we created to <code>print</code> the &ldquo;@&rdquo; symbol at the given x and y coordinates. Try changing the x and y values and see what happens, if you feel so inclined.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3">            context<span style="color:#f92672">.</span>present(root_console)</code></pre></div>
<p>Without this line, nothing would actually print out on the screen. This is because <code>context.present</code> is what actually updates the screen with what we&rsquo;ve told it to display so far.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3">            <span style="color:#66d9ef">for</span> event <span style="color:#f92672">in</span> tcod<span style="color:#f92672">.</span>event<span style="color:#f92672">.</span>wait():
                <span style="color:#66d9ef">if</span> event<span style="color:#f92672">.</span>type <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;QUIT&#34;</span>:
                    <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">SystemExit</span>()</code></pre></div>
<p>This part gives us a way to gracefully exit (i.e. not crashing) the program by hitting the <code>X</code> button in the console&rsquo;s window. The line <code>for event in tcod.event.wait()</code> will wait for some sort of input from the user (mouse clicks, keyboard strokes, etc.) and loop through each event that happened. <code>SystemExit()</code> tells Python to quit the current running program.</p>
<p>Alright, our &ldquo;@&rdquo; symbol is successfully displayed on the screen, but we can&rsquo;t rest just yet. We still need to get it moving around!</p>
<p>We need to keep track of the player&rsquo;s position at all times. Since this is a 2D game, we can express this in two data points: the <code>x</code> and <code>y</code> coordinates. Let&rsquo;s create two variables, <code>player_x</code> and <code>player_y</code>, to keep track of this.</p>
<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

  
<div class="data-pane active" data-pane="diff">
  
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">    ...
    screen_height = 50
<span style="color:#a6e22e">+
</span><span style="color:#a6e22e">+   player_x = int(screen_width / 2)
</span><span style="color:#a6e22e">+   player_y = int(screen_height / 2)
</span><span style="color:#a6e22e">+
</span><span style="color:#a6e22e"></span>    tileset = tcod.tileset.load_tilesheet(
        &#34;dejavu10x10_gs_tc.png&#34;, 32, 8, tcod.tileset.CHARMAP_TCOD
    )
    ...
</code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>    ...
    screen_height = 50
    <span class="new-text">
    player_x = int(screen_width / 2)
    player_y = int(screen_height / 2)
    </span>
    tileset = tcod.tileset.load_tilesheet(
        "dejavu10x10_gs_tc.png", 32, 8, tcod.tileset.CHARMAP_TCOD
    )
    ...</pre>

</div>

</div>

<script src="/js/codetabs.js"></script>
<p><em>Note: Ellipses denote omitted parts of the code. I&rsquo;ll include lines around the code to be inserted so that you&rsquo;ll know exactly where to put new pieces of code, but I won&rsquo;t be showing the entire file every time. The green lines denote code that you should be adding.</em></p>
<p>We&rsquo;re placing the player right in the middle of the screen. What&rsquo;s with the <code>int()</code> function though? Well, Python 3 doesn&rsquo;t automatically
truncate division like Python 2 does, so we have to cast the division result (a float) to an integer. If we don&rsquo;t, tcod will give an error.</p>
<p><em>Note: It&rsquo;s been pointed out that you could divide with <code>//</code> instead of <code>/</code> and achieve the same effect. This is true, except in cases where, for whatever reason, one of the numbers given is a decimal. For example, <code>screen_width // 2.0</code> will give an error. That shouldn&rsquo;t happen in this case, but wrapping the function in <code>int()</code> gives us certainty that this won&rsquo;t ever happen.</em></p>
<p>We also have to modify the command to put the &lsquo;@&rsquo; symbol to use these new coordinates.</p>
<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

  
<div class="data-pane active" data-pane="diff">
  
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">        ...
        while True:
<span style="color:#f92672">-           root_console.print(x=1, y=1, string=&#34;@&#34;)
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+           root_console.print(x=player_x, y=player_y, string=&#34;@&#34;)
</span><span style="color:#a6e22e"></span>
            context.present(root_console)
            ...
</code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>        ...
        while True:
            <span class="crossed-out-text">root_console.print(x=1, y=1, string="@")</span>
            <span class="new-text">root_console.print(x=player_x, y=player_y, string="@")</span>

            context.present(root_console)
            ...</pre>

</div>

</div>

<script src="/js/codetabs.js"></script>
<p><em>Note: The red lines denote code that has been removed.</em></p>
<p>Run the code now and you should see the &lsquo;@&rsquo; in the center of the screen. Let&rsquo;s take care of moving it around now.</p>
<p>So, how do we actually capture the user&rsquo;s input? TCOD makes this pretty easy, and in fact, we&rsquo;re already doing it. This line takes care of it for us:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3">            <span style="color:#66d9ef">for</span> event <span style="color:#f92672">in</span> tcod<span style="color:#f92672">.</span>event<span style="color:#f92672">.</span>wait():</code></pre></div>
<p>It gets the &ldquo;events&rdquo;, which we can then process. Events range from mouse movements to keyboard strokes. Let&rsquo;s start by getting some basic keyboard commands and processing them, and based on what we get, we&rsquo;ll move our little &ldquo;@&rdquo; symbol around.</p>
<p>We <em>could</em> identify which key is being pressed right here in <code>main.py</code>, but this is a good opportunity to break our project up a little bit. Sooner or later, we&rsquo;re going to have quite a few potential keyboard commands, so putting them all in <code>main.py</code> would make the file longer than it needs to be. Maybe we should import what we need into <code>main.py</code> rather than writing it all there.</p>
<p>To handle the keyboard inputs and the actions associated with them, let&rsquo;s actually create <em>two</em> new files. One will hold the different types of &ldquo;actions&rdquo; our rogue can perform, and the other will bridge the gap between the keys we press and those actions.</p>
<p>Create two new Python files in your project&rsquo;s directory, one called <code>input_handlers.py</code>, and the other called <code>actions.py</code>. Let&rsquo;s fill out <code>actions.py</code> first:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Action</span>:
    <span style="color:#66d9ef">pass</span>


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">EscapeAction</span>(Action):
    <span style="color:#66d9ef">pass</span>


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MovementAction</span>(Action):
    <span style="color:#66d9ef">def</span> __init__(self, dx: int, dy: int):
        super()<span style="color:#f92672">.</span>__init__()

        self<span style="color:#f92672">.</span>dx <span style="color:#f92672">=</span> dx
        self<span style="color:#f92672">.</span>dy <span style="color:#f92672">=</span> dy</code></pre></div>
<p>We define three classes: <code>Action</code>, <code>EscapeAction</code>, and <code>MovementAction</code>. <code>EscapeAction</code> and <code>MovementAction</code> are subclasses of <code>Action</code>.</p>
<p>So what&rsquo;s the plan for these classes? Basically, whenever we have an &ldquo;action&rdquo;, we&rsquo;ll use one of the subclasses of <code>Action</code> to describe it. We&rsquo;ll be able to detect which subclass we&rsquo;re using, and respond accordingly. In this case, <code>EscapeAction</code> will be when we hit the <code>Esc</code> key (to exit the game), and <code>MovementAction</code> will be used to describe our player moving around.</p>
<p>There might be instances where we need to know more than just the &ldquo;type&rdquo; of action, like in the case of <code>MovementAction</code>. There, we need to know not only that we&rsquo;re trying to move, but in which direction. Therefore, we can pass the <code>dx</code> and <code>dy</code> arguments to <code>MovementAction</code>, which will tell us where the player is trying to move to. Other <code>Action</code> subclasses might contain additional data as well, and others might just be subclasses with nothing else in them, like <code>EscapeAction</code>.</p>
<p>That&rsquo;s all we need to do in <code>actions.py</code> right now. Let&rsquo;s fill out <code>input_handlers.py</code>, which will use the <code>Action</code> class and subclasses we just created:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3"><span style="color:#f92672">from</span> typing <span style="color:#f92672">import</span> Optional

<span style="color:#f92672">import</span> tcod.event

<span style="color:#f92672">from</span> actions <span style="color:#f92672">import</span> Action, EscapeAction, MovementAction


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">EventHandler</span>(tcod<span style="color:#f92672">.</span>event<span style="color:#f92672">.</span>EventDispatch[Action]):
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">ev_quit</span>(self, event: tcod<span style="color:#f92672">.</span>event<span style="color:#f92672">.</span>Quit) <span style="color:#f92672">-&gt;</span> Optional[Action]:
        <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">SystemExit</span>()

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">ev_keydown</span>(self, event: tcod<span style="color:#f92672">.</span>event<span style="color:#f92672">.</span>KeyDown) <span style="color:#f92672">-&gt;</span> Optional[Action]:
        action: Optional[Action] <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>

        key <span style="color:#f92672">=</span> event<span style="color:#f92672">.</span>sym

        <span style="color:#66d9ef">if</span> key <span style="color:#f92672">==</span> tcod<span style="color:#f92672">.</span>event<span style="color:#f92672">.</span>K_UP:
            action <span style="color:#f92672">=</span> MovementAction(dx<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, dy<span style="color:#f92672">=-</span><span style="color:#ae81ff">1</span>)
        <span style="color:#66d9ef">elif</span> key <span style="color:#f92672">==</span> tcod<span style="color:#f92672">.</span>event<span style="color:#f92672">.</span>K_DOWN:
            action <span style="color:#f92672">=</span> MovementAction(dx<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, dy<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
        <span style="color:#66d9ef">elif</span> key <span style="color:#f92672">==</span> tcod<span style="color:#f92672">.</span>event<span style="color:#f92672">.</span>K_LEFT:
            action <span style="color:#f92672">=</span> MovementAction(dx<span style="color:#f92672">=-</span><span style="color:#ae81ff">1</span>, dy<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)
        <span style="color:#66d9ef">elif</span> key <span style="color:#f92672">==</span> tcod<span style="color:#f92672">.</span>event<span style="color:#f92672">.</span>K_RIGHT:
            action <span style="color:#f92672">=</span> MovementAction(dx<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, dy<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)

        <span style="color:#66d9ef">elif</span> key <span style="color:#f92672">==</span> tcod<span style="color:#f92672">.</span>event<span style="color:#f92672">.</span>K_ESCAPE:
            action <span style="color:#f92672">=</span> EscapeAction()

        <span style="color:#75715e"># No valid key was pressed</span>
        <span style="color:#66d9ef">return</span> action</code></pre></div>
<p>Let&rsquo;s go over what we&rsquo;ve added.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3"><span style="color:#f92672">from</span> typing <span style="color:#f92672">import</span> Optional</code></pre></div>
<p>This is part of Python&rsquo;s type hinting system (which you don&rsquo;t have to include in your project). <code>Optional</code> denotes something that could be set to <code>None</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3"><span style="color:#f92672">import</span> tcod.event

<span style="color:#f92672">from</span> actions <span style="color:#f92672">import</span> Action, EscapeAction, MovementAction</code></pre></div>
<p>We&rsquo;re importing <code>tcod.event</code> so that we can use tcod&rsquo;s event system. We don&rsquo;t need to import <code>tcod</code>, as we only need the contents of <code>event</code>.</p>
<p>The next line imports the <code>Action</code> class and its subclasses that we just created.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">EventHandler</span>(tcod<span style="color:#f92672">.</span>event<span style="color:#f92672">.</span>EventDispatch[Action]):</code></pre></div>
<p>We&rsquo;re creating a class called <code>EventHandler</code>, which is a subclass of tcod&rsquo;s <code>EventDispatch</code> class. <code>EventDispatch</code> is a class that allows us to send an event to its proper method based on what type of event it is. Let&rsquo;s take a look at the methods we&rsquo;re creating for <code>EventHandler</code> to see a few examples of this.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3">    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">ev_quit</span>(self, event: tcod<span style="color:#f92672">.</span>event<span style="color:#f92672">.</span>Quit) <span style="color:#f92672">-&gt;</span> Optional[Action]:
        <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">SystemExit</span>()</code></pre></div>
<p>Here&rsquo;s an example of us using a method of <code>EventDispatch</code>: <code>ev_quit</code> is a method defined in <code>EventDispatch</code>, which we&rsquo;re overriding in <code>EventHandler</code>. <code>ev_quit</code> is called when we receive a &ldquo;quit&rdquo; event, which happens when we click the &ldquo;X&rdquo; in the window of the program. In that case, we want to quit the program, so we raise <code>SystemExit()</code> to do so.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3">    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">ev_keydown</span>(self, event: tcod<span style="color:#f92672">.</span>event<span style="color:#f92672">.</span>KeyDown) <span style="color:#f92672">-&gt;</span> Optional[Action]:</code></pre></div>
<p>This method will receive key press events, and return either an <code>Action</code> subclass, or <code>None</code>, if no valid key was pressed.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3">        action: Optional[Action] <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>

        key <span style="color:#f92672">=</span> event<span style="color:#f92672">.</span>sym</code></pre></div>
<p><code>action</code> is the variable that will hold whatever subclass of <code>Action</code> we end up assigning it to. If no valid key press is found, it will remain set to <code>None</code>. We&rsquo;ll return it either way.</p>
<p><code>key</code> holds the actual key we pressed. It doesn&rsquo;t contain additional information about modifiers like <code>Shift</code> or <code>Alt</code>, just the actual key that was pressed. That&rsquo;s all we need right now.</p>
<p>From there, we go down a list of possible keys pressed. For example:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3">        <span style="color:#66d9ef">if</span> key <span style="color:#f92672">==</span> tcod<span style="color:#f92672">.</span>event<span style="color:#f92672">.</span>K_UP:
            action <span style="color:#f92672">=</span> MovementAction(dx<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, dy<span style="color:#f92672">=-</span><span style="color:#ae81ff">1</span>)</code></pre></div>
<p>In this case, the user pressed the up-arrow key, so we&rsquo;re creating a <code>MovementAction</code>. Notice that here (and in all the other cases of <code>MovementAction</code>) we provide <code>dx</code> and <code>dy</code>. These describe which direction our character will move in.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3">        <span style="color:#66d9ef">elif</span> key <span style="color:#f92672">==</span> tcod<span style="color:#f92672">.</span>event<span style="color:#f92672">.</span>K_ESCAPE:
            action <span style="color:#f92672">=</span> EscapeAction()</code></pre></div>
<p>If the user pressed the &ldquo;Escape&rdquo; key, we return <code>EscapeAction</code>. We&rsquo;ll use this to exit the game for now, though in the future, <code>EscapeAction</code> can be used to do things like exit menus.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3">        <span style="color:#66d9ef">return</span> action</code></pre></div>
<p>Whether <code>action</code> is assigned to an <code>Action</code> subclass or <code>None</code>, we return it.</p>
<p>Let&rsquo;s put our new actions and input handlers to use in <code>main.py</code>. Edit <code>main.py</code> like this:</p>
<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

  
<div class="data-pane active" data-pane="diff">
  
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">#!/usr/bin/env python3
import tcod

<span style="color:#a6e22e">+from actions import EscapeAction, MovementAction
</span><span style="color:#a6e22e">+from input_handlers import EventHandler
</span><span style="color:#a6e22e"></span>

def main() -&gt; None:
    screen_width = 80
    screen_height = 50

    player_x = int(screen_width / 2)
    player_y = int(screen_height / 2)

    tileset = tcod.tileset.load_tilesheet(
        &#34;dejavu10x10_gs_tc.png&#34;, 32, 8, tcod.tileset.CHARMAP_TCOD
    )

<span style="color:#a6e22e">+   event_handler = EventHandler()
</span><span style="color:#a6e22e"></span>
    with tcod.context.new_terminal(
        ...

            ...
            for event in tcod.event.wait():
<span style="color:#f92672">-               if event.type == &#34;QUIT&#34;:
</span><span style="color:#f92672">-                   raise SystemExit()
</span><span style="color:#f92672"></span>
<span style="color:#a6e22e">+               action = event_handler.dispatch(event)
</span><span style="color:#a6e22e"></span>
<span style="color:#a6e22e">+               if action is None:
</span><span style="color:#a6e22e">+                   continue
</span><span style="color:#a6e22e"></span>
<span style="color:#a6e22e">+               if isinstance(action, MovementAction):
</span><span style="color:#a6e22e">+                   player_x += action.dx
</span><span style="color:#a6e22e">+                   player_y += action.dy
</span><span style="color:#a6e22e"></span>
<span style="color:#a6e22e">+               elif isinstance(action, EscapeAction):
</span><span style="color:#a6e22e">+                   raise SystemExit()
</span><span style="color:#a6e22e"></span>

if __name__ == &#34;__main__&#34;:
    main()
</code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>#!/usr/bin/env python3
import tcod

<span class="new-text">from actions import EscapeAction, MovementAction
from input_handlers import EventHandler</span>


def main() -> None:
    screen_width = 80
    screen_height = 50

    player_x = int(screen_width / 2)
    player_y = int(screen_height / 2)

    tileset = tcod.tileset.load_tilesheet(
        "dejavu10x10_gs_tc.png", 32, 8, tcod.tileset.CHARMAP_TCOD
    )

    <span class="new-text">event_handler = EventHandler()</span>

    with tcod.context.new_terminal(
        ...

            ...
            for event in tcod.event.wait():
                <span class="crossed-out-text">if event.type == "QUIT":</span>
                    <span class="crossed-out-text">raise SystemExit()</span>
                <span class="new-text">
                action = event_handler.dispatch(event)

                if action is None:
                    continue

                if isinstance(action, MovementAction):
                    player_x += action.dx
                    player_y += action.dy

                elif isinstance(action, EscapeAction):
                    raise SystemExit()</span>


if __name__ == "__main__":
    main()</pre>

</div>

</div>

<script src="/js/codetabs.js"></script>
<p>Let&rsquo;s break down the new additions a bit.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3"><span style="color:#f92672">from</span> actions <span style="color:#f92672">import</span> EscapeAction, MovementAction
<span style="color:#f92672">from</span> input_handlers <span style="color:#f92672">import</span> EventHandler</code></pre></div>
<p>We&rsquo;re importing the <code>EscapeAction</code> and <code>MovementAction</code> from <code>actions</code>, and <code>EventHandler</code> from <code>input_handlers</code>. This allows us to use the functions we wrote in those files in our <code>main</code> file.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3">    event_handler <span style="color:#f92672">=</span> EventHandler()</code></pre></div>
<p><code>event_handler</code> is an instance of our <code>EventHandler</code> class. We&rsquo;ll use it to receive events and process them.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3">                action <span style="color:#f92672">=</span> event_handler<span style="color:#f92672">.</span>dispatch(event)</code></pre></div>
<p>We send the <code>event</code> to our <code>event_handler</code>&rsquo;s &ldquo;dispatch&rdquo; method, which sends the event to its proper place. In this case, a keyboard event will be sent to the <code>ev_keydown</code> method we wrote. The <code>Action</code> returned from that method is assigned to our local <code>action</code> variable.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3">                <span style="color:#66d9ef">if</span> action <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span>:
                    <span style="color:#66d9ef">continue</span></code></pre></div>
<p>This is pretty straightforward: If <code>action</code> is <code>None</code> (that is, no key was pressed, or the key pressed isn&rsquo;t recognized), then we skip over the rest the loop. There&rsquo;s no need to go any further, since the lines below are going to handle the valid key presses.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3">                <span style="color:#66d9ef">if</span> isinstance(action, MovementAction):
                    player_x <span style="color:#f92672">+=</span> action<span style="color:#f92672">.</span>dx
                    player_y <span style="color:#f92672">+=</span> action<span style="color:#f92672">.</span>dy</code></pre></div>
<p>Now we arrive at the interesting part. If the <code>action</code> is an instance of the class <code>MovementAction</code>, we need to move our &ldquo;@&rdquo; symbol. We grab the <code>dx</code> and <code>dy</code> values we gave to <code>MovementAction</code> earlier, which will move the &ldquo;@&rdquo; symbol in which direction we want it to move. <code>dx</code> and <code>dy</code>, as of now, will only ever be -1, 0, or 1. Regardless of what the value is, we add <code>dx</code> and <code>dy</code> to <code>player_x</code> and <code>player_y</code>, respectively. Because the console is using <code>player_x</code> and <code>player_y</code> to draw where our &ldquo;@&rdquo; symbol is, modifying these two variables will cause the symbol to move.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3">                <span style="color:#66d9ef">elif</span> isinstance(action, EscapeAction):
                    <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">SystemExit</span>()</code></pre></div>
<p><code>raise SystemExit()</code> should look familiar: it&rsquo;s how we&rsquo;re quitting out of the program. So basically, if the user hits the <code>Esc</code> key, our program should exit.</p>
<p>With all that done, let&rsquo;s run the program and see what happens!</p>
<p>Indeed, our &ldquo;@&rdquo; symbol does move, but&hellip; it&rsquo;s perhaps not what was expected.</p>
<p><img src="/images/snake_the_roguelike.png" alt="Snake the Roguelike?" title="Snake the Roguelike?"></p>
<p>Unless you&rsquo;re making a roguelike version of &ldquo;Snake&rdquo; (and who knows, maybe you are), we need to fix the &ldquo;@&rdquo; symbol being left behind wherever we move. So why is this happening in the first place?</p>
<p>Turns out, we need to &ldquo;clear&rdquo; the console after we&rsquo;ve drawn it, or we&rsquo;ll get these leftovers when we draw symbols in their new places. Luckily, this is as easy as adding one line:</p>
<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

  
<div class="data-pane active" data-pane="diff">
  
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">    ...
        while True:
            root_console.print(x=player_x, y=player_y, string=&#34;@&#34;)

            context.present(root_console)

<span style="color:#a6e22e">+           root_console.clear()
</span><span style="color:#a6e22e"></span>
            for event in tcod.event.wait():
                ...
</code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>    ...
        while True:
            root_console.print(x=player_x, y=player_y, string="@")

            context.present(root_console)

            <span class="new-text">root_console.clear()</span>

            for event in tcod.event.wait():
                ...</pre>

</div>

</div>

<script src="/js/codetabs.js"></script>
<p>That&rsquo;s it! Run the project now, and the &ldquo;@&rdquo; symbol will move around, without leaving traces of itself behind.</p>
<p>That wraps up part one of this tutorial! If you&rsquo;re using git or some
other form of version control (and I recommend you do), commit your
changes now.</p>
<p>If you want to see the code so far in its entirety, <a href="https://github.com/TStand90/tcod_tutorial_v2/tree/2020/part-1">click
here</a>.</p>
<p><a href="/tutorials/tcod/v2/part-2">Click here to move on to the next part of this
tutorial.</a></p>


    

    


</article>



        </div>

        <aside class="col-12 col-lg-3 ml-auto blog-sidebar">
    
    
        <section>
    
        
    
        
    
</section>
    
</aside>

      </div>
    </div>
    

    
      







<footer class="blog-footer w-100">
    <nav class="navbar navbar-light bg-light">
        <p class="w-100 text-center">Last updated July 7th, 2020</p>
        <p class="w-100 text-center"><a href="#">Back to top</a></p>
    </nav>
</footer>

    

    
    
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
  </body>
</html>
