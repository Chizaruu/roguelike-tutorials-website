<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta property="og:title" content="Part 3 - Generating a dungeon" />
<meta property="og:description" content="Welcome back to the Roguelike Tutorial Revised! In this tutorial, we&rsquo;ll be taking a very important step towards having a real, functioning game: Creating a procedurally generated dungeon!
Remember that little wall we created for demonstration purposes in the last tutorial? We don&rsquo;t need it anymore, so let&rsquo;s take it out.
DiffOriginal- tiles[30][22].blocked = True - tiles[30][22].block_sight = True - tiles[31][22].blocked = True - tiles[31][22].block_sight = True - tiles[32][22]." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://rogueliketutorials.com/tutorials/tcod/2019/part-3/" /><meta property="article:section" content="tutorials" />
<meta property="article:published_time" content="2019-03-30T08:39:22-07:00" />
<meta property="article:modified_time" content="2019-03-30T08:39:22-07:00" />


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Part 3 - Generating a dungeon"/>
<meta name="twitter:description" content="Welcome back to the Roguelike Tutorial Revised! In this tutorial, we&rsquo;ll be taking a very important step towards having a real, functioning game: Creating a procedurally generated dungeon!
Remember that little wall we created for demonstration purposes in the last tutorial? We don&rsquo;t need it anymore, so let&rsquo;s take it out.
DiffOriginal- tiles[30][22].blocked = True - tiles[30][22].block_sight = True - tiles[31][22].blocked = True - tiles[31][22].block_sight = True - tiles[32][22]."/>



    <link rel="canonical" href="https://rogueliketutorials.com/tutorials/tcod/2019/part-3/">

    <title>
      
        Part 3 - Generating a dungeon | Roguelike Tutorials
      
    </title>

    
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link href="https://rogueliketutorials.com/css/style.css" rel="stylesheet">

    

    

    
  </head>
  <body>
    
      

<header class="blog-header">
    <nav class="navbar navbar-expand-md navbar-dark bg-dark">
        <a class="navbar-brand" href="/">
            Roguelike Tutorials
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false"
            aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-between" id="navbarNav">
            <ul class="navbar-nav">
                
                
                <li class="nav-item ">
                    
                        <a class="nav-link" href="/">Home</a>
                    
                </li>
                
                <li class="nav-item ">
                    
                        <a class="nav-link" href="/tutorials/tcod/2019/">TCOD Tutorial (2019)</a>
                    
                </li>
                
                <li class="nav-item ">
                    
                        <a class="nav-link" href="/tutorials/tcod/v2/">TCOD Tutorial (2020)</a>
                    
                </li>
                
                <li class="nav-item ">
                    
                        <a class="nav-link" href="/about/">About</a>
                    
                </li>
                
            </ul>
            
        </div>
    </nav>
</header>

    

    
    <div class="container">
      <div class="row">
        <div class="col-12 col-lg-8 blog-main">

          

<header>
    <h2 class="blog-post-title">
    <a class="text-dark" href="/tutorials/tcod/2019/part-3/">Part 3 - Generating a dungeon</a>
</h2>

    


<div class="blog-post-date text-secondary">
    
        <time datetime="2019-03-30">Mar 30, 2019</time>
    
    
</div>

    
    
    <hr>
</header>
<article class="blog-post">
    <p>Welcome back to the Roguelike Tutorial Revised! In this tutorial, we&rsquo;ll
be taking a <strong>very</strong> important step towards having a real, functioning
game: Creating a procedurally generated dungeon!</p>
<p>Remember that little wall we created for demonstration purposes in the
last tutorial? We don&rsquo;t need it anymore, so let&rsquo;s take it out.</p>
<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

  
<div class="data-pane active" data-pane="diff">
  
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff"><span style="color:#f92672">-       tiles[30][22].blocked = True
</span><span style="color:#f92672">-       tiles[30][22].block_sight = True
</span><span style="color:#f92672">-       tiles[31][22].blocked = True
</span><span style="color:#f92672">-       tiles[31][22].block_sight = True
</span><span style="color:#f92672">-       tiles[32][22].blocked = True
</span><span style="color:#f92672">-       tiles[32][22].block_sight = True
</span></code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>        <span class="crossed-out-text">tiles[30][22].blocked = True</span>
        <span class="crossed-out-text">tiles[30][22].block_sight = True</span>
        <span class="crossed-out-text">tiles[31][22].blocked = True</span>
        <span class="crossed-out-text">tiles[31][22].block_sight = True</span>
        <span class="crossed-out-text">tiles[32][22].blocked = True</span>
        <span class="crossed-out-text">tiles[32][22].block_sight = True</span></pre>

</div>

</div>

<script src="/js/codetabs.js"></script>
<p>We also need to make a slight change to the list comprehension that
created our
Tiles.</p>
<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

  
<div class="data-pane active" data-pane="diff">
  
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff"><span style="color:#f92672">-       tiles = [[Tile(False) for y in range(self.height)] for x in range(self.width)]
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+       tiles = [[Tile(True) for y in range(self.height)] for x in range(self.width)]
</span></code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>        <span class="crossed-out-text">tiles = [[Tile(False) for y in range(self.height)] for x in range(self.width)]</span>
        <span class="new-text">tiles = [[Tile(True) for y in range(self.height)] for x in range(self.width)]</span></pre>

</div>

</div>

<script src="/js/codetabs.js"></script>
<p>Why are we changing the <code>False</code> to <code>True</code>? Before, we were setting every
Tile to be walk-able by default, so that we could move around easily.
Hence, we passed <code>False</code> to the <code>Tile</code> class, so that the <code>blocked</code>
attribute would be False.</p>
<p>However, our dungeon generation algorithm works the opposite way: We
start with a completely walled off room, and start &ldquo;digging&rdquo; out
sections as we go along. Therefore, we initialize all our tiles to be
blocked by default. For the record: every dungeon generation algorithm
I&rsquo;ve seen does this in some way.</p>
<p>One more thing we&rsquo;ll want to do before getting to our dungeon algorithm
is defining a helper class for our &ldquo;rooms&rdquo;. This will be a basic class
that holds some information about dimensions, which we&rsquo;ll call <code>Rect</code>
(short for rectangle). Create a new file in the <code>map_objects</code> folder,
and name it <code>rectangle.py</code>. Enter the following code into it:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Rect</span>:
    <span style="color:#66d9ef">def</span> __init__(self, x, y, w, h):
        self<span style="color:#f92672">.</span>x1 <span style="color:#f92672">=</span> x
        self<span style="color:#f92672">.</span>y1 <span style="color:#f92672">=</span> y
        self<span style="color:#f92672">.</span>x2 <span style="color:#f92672">=</span> x <span style="color:#f92672">+</span> w
        self<span style="color:#f92672">.</span>y2 <span style="color:#f92672">=</span> y <span style="color:#f92672">+</span> h</code></pre></div>
<p>The <code>__init__</code> function takes the x and y coordinates of the top left
corner, and computes the bottom right corner based on the w and h
parameters (width and height). We&rsquo;ll be adding more to this class
shortly, but to get us started, that&rsquo;s all we need.</p>
<p>Now, if we&rsquo;re going to be &ldquo;carving out&rdquo; a bunch of rooms to create our
dungeon, we&rsquo;ll want a function to create a room. This function should
take an argument, which we&rsquo;ll call <code>room</code>, and that argument should be
of the <code>Rect</code> class we just created. From x1 to x2, and y1 to y2, we&rsquo;ll
want to set each tile in the <code>Rect</code> to be not blocked, so the player can
move around in it. We can put this function in the <code>GameMap</code> class,
since it will be manipulating the map&rsquo;s list of tiles.</p>
<p>What we end up with is this function:</p>
<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

   <div class="data-pane active" data-pane="diff">
   <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">    def initialize_tiles(self):
        ...

<span style="color:#a6e22e">+   def create_room(self, room):
</span><span style="color:#a6e22e">+       # go through the tiles in the rectangle and make them passable
</span><span style="color:#a6e22e">+       for x in range(room.x1 + 1, room.x2):
</span><span style="color:#a6e22e">+           for y in range(room.y1 + 1, room.y2):
</span><span style="color:#a6e22e">+               self.tiles[x][y].blocked = False
</span><span style="color:#a6e22e">+               self.tiles[x][y].block_sight = False
</span><span style="color:#a6e22e"></span>
    def is_blocked(self, x, y):
        ...
</code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>    def initialize_tiles(self):
        ...

    <span class="new-text">def create_room(self, room):
        # go through the tiles in the rectangle and make them passable
        for x in range(room.x1 + 1, room.x2):
            for y in range(room.y1 + 1, room.y2):
                self.tiles[x][y].blocked = False
                self.tiles[x][y].block_sight = False</span>

    def is_blocked(self, x, y):
        ...</pre>

</div>

</div>

<script src="/js/codetabs.js"></script>
<p><em>* Note: <code>initialize_tiles</code> and <code>is_blocked</code> shortened for the sake of
brevity.</em></p>
<p>What&rsquo;s with the + 1 on room.x1 and room.y1? Think about what we&rsquo;re
saying when we tell our program that we want a room at coordinates (1,</p>
<ol>
<li>that goes to (6, 6). You might assume that would carve out a room
like this one (remember that lists are 0-indexed, so (0, 0) is a wall in
this case):</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">  0 1 2 3 4 5 6 7
0 # # # # # # # #
1 # . . . . . . #
2 # . . . . . . #
3 # . . . . . . #
4 # . . . . . . #
5 # . . . . . . #
6 # . . . . . . #
7 # # # # # # # #
</code></pre></div><p>That&rsquo;s all fine and good, but what happens if we put a room right next
to it? Let&rsquo;s say this room starts at (7, 1) and goes to (9, 6)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">  0 1 2 3 4 5 6 7 8 9 10
0 # # # # # # # # # # #
1 # . . . . . . . . . #
2 # . . . . . . . . . #
3 # . . . . . . . . . #
4 # . . . . . . . . . #
5 # . . . . . . . . . #
6 # . . . . . . . . . #
7 # # # # # # # # # # #
</code></pre></div><p>There&rsquo;s no wall separating the two! That means that if two rooms are
one right next to the other, then there won&rsquo;t be a wall between them!
So long story short, our function needs to take the walls into account
when digging out a room. So if we have a rectangle with coordinates x1 =
1, x2 = 6, y1 = 1, and y2 = 6, then the room should actually look like
this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">  0 1 2 3 4 5 6 7
0 # # # # # # # #
1 # # # # # # # #
2 # # . . . . # #
3 # # . . . . # #
4 # # . . . . # #
5 # # . . . . # #
6 # # # # # # # #
7 # # # # # # # #
</code></pre></div><p>This ensures that we&rsquo;ll always have at least a one tile wide wall
between our rooms, unless we choose to create overlapping rooms. In
order to accomplish this, we add + 1 to x1 and y1.</p>
<p><em>* Note: In case you&rsquo;re wondering, we don&rsquo;t subtract 1 from x2 and y2
because Python&rsquo;s range function does not include the &lsquo;end&rsquo; value in its
range. For example, range(0, 10) would give us [0, 1, 2, 3, 4, 5, 6, 7,
8, 9].</em></p>
<p>Let&rsquo;s make some rooms! We&rsquo;ll need a function in <code>GameMap</code> to generate
our map, so let&rsquo;s add one:</p>
<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

   <div class="data-pane active" data-pane="diff">
   <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">    def initialize_tiles(self):
        ...

<span style="color:#a6e22e">+   def make_map(self):
</span><span style="color:#a6e22e">+       # Create two rooms for demonstration purposes
</span><span style="color:#a6e22e">+       room1 = Rect(20, 15, 10, 15)
</span><span style="color:#a6e22e">+       room2 = Rect(35, 15, 10, 15)
</span><span style="color:#a6e22e">+
</span><span style="color:#a6e22e">+       self.create_room(room1)
</span><span style="color:#a6e22e">+       self.create_room(room2)
</span><span style="color:#a6e22e"></span>
    def create_room(self, room):
        ...
</code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>    def initialize_tiles(self):
        ...

    <span class="new-text">def make_map(self):
        # Create two rooms for demonstration purposes
        room1 = Rect(20, 15, 10, 15)
        room2 = Rect(35, 15, 10, 15)

        self.create_room(room1)
        self.create_room(room2)</span>

    def create_room(self, room):
        ...</pre>

</div>

</div>

<script src="/js/codetabs.js"></script>
<p>We need to import the <code>Rect</code> class into the <code>game_map</code> file in order for
this to work. At the top of the file, modify your import section:</p>
<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

   <div class="data-pane active" data-pane="diff">
   <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff"><span style="color:#a6e22e">+from map_objects.rectangle import Rect
</span><span style="color:#a6e22e"></span>from map_objects.tile import Tile
</code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
        <pre><span class="new-text">from map_objects.rectangle import Rect</span>
from map_objects.tile import Tile</pre>

</div>

</div>

<script src="/js/codetabs.js"></script>
<p>Finally, modify <code>engine.py</code> to actually call the new <code>make_map</code>
function.</p>
<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

   <div class="data-pane active" data-pane="diff">
   <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">    game_map = GameMap(map_width, map_height)
<span style="color:#a6e22e">+   game_map.make_map()
</span></code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
    <pre>    game_map = GameMap(map_width, map_height)
    <span class="new-text">game_map.make_map()</span></pre>

</div>

</div>

<script src="/js/codetabs.js"></script>
<p>Now is a good time to run your code and make sure everything works as
expected. The changes we&rsquo;ve made puts two sample rooms on the map, with
our player in one of them (our poor NPC is stuck in a wall though).</p>
<p>I&rsquo;m sure you&rsquo;ve noticed already, but the rooms are not connected. What&rsquo;s
the use of creating a dungeon if we&rsquo;re stuck in one room? Not to worry,
let&rsquo;s write some code to generate tunnels from one room to another. Add
the following methods to <code>GameMap</code>:</p>
<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

   <div class="data-pane active" data-pane="diff">
   <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">    def create_room(self, room):
        ...

<span style="color:#a6e22e">+   def create_h_tunnel(self, x1, x2, y):
</span><span style="color:#a6e22e">+       for x in range(min(x1, x2), max(x1, x2) + 1):
</span><span style="color:#a6e22e">+           self.tiles[x][y].blocked = False
</span><span style="color:#a6e22e">+           self.tiles[x][y].block_sight = False
</span><span style="color:#a6e22e">+
</span><span style="color:#a6e22e">+   def create_v_tunnel(self, y1, y2, x):
</span><span style="color:#a6e22e">+       for y in range(min(y1, y2), max(y1, y2) + 1):
</span><span style="color:#a6e22e">+           self.tiles[x][y].blocked = False
</span><span style="color:#a6e22e">+           self.tiles[x][y].block_sight = False
</span><span style="color:#a6e22e"></span>
    def is_blocked(self, x, y):
        ...
</code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>    def create_room(self, room):
        ...

    <span class="new-text">def create_h_tunnel(self, x1, x2, y):
        for x in range(min(x1, x2), max(x1, x2) + 1):
            self.tiles[x][y].blocked = False
            self.tiles[x][y].block_sight = False

    def create_v_tunnel(self, y1, y2, x):
        for y in range(min(y1, y2), max(y1, y2) + 1):
            self.tiles[x][y].blocked = False
            self.tiles[x][y].block_sight = False</span>

    def is_blocked(self, x, y):
        ...
        </pre>

</div>

</div>

<script src="/js/codetabs.js"></script>
<p>Let&rsquo;s put this code to use by drawing a tunnel between our two rooms.</p>
<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

   <div class="data-pane active" data-pane="diff">
   <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">        ...
        self.create_room(room2)

<span style="color:#a6e22e">+       self.create_h_tunnel(25, 40, 23)
</span></code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>        ...
        self.create_room(room2)

        <span class="new-text">self.create_h_tunnel(25, 40, 23)</span></pre>

</div>

</div>

<script src="/js/codetabs.js"></script>
<p>Now that we&rsquo;ve demonstrated to ourselves that our room and tunnel
functions work as intended, it&rsquo;s time to move on to an actual dungeon
generation algorithm. Ours will be fairly simple; we&rsquo;ll place rooms one
at a time, making sure they don&rsquo;t overlap, and connect them with
tunnels.</p>
<p>We&rsquo;ll need two additional functions in the <code>Rect</code> class to ensure that
two rectangles (rooms) don&rsquo;t overlap. Enter the following methods into
the <code>Rect</code> class:</p>
<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

   <div class="data-pane active" data-pane="diff">
   <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">class Rect:
    def __init__(self, x, y, w, h):
        self.x1 = x
        self.y1 = y
        self.x2 = x + w
        self.y2 = y + h

<span style="color:#a6e22e">+   def center(self):
</span><span style="color:#a6e22e">+       center_x = int((self.x1 + self.x2) / 2)
</span><span style="color:#a6e22e">+       center_y = int((self.y1 + self.y2) / 2)
</span><span style="color:#a6e22e">+       return (center_x, center_y)
</span><span style="color:#a6e22e">+
</span><span style="color:#a6e22e">+   def intersect(self, other):
</span><span style="color:#a6e22e">+       # returns true if this rectangle intersects with another one
</span><span style="color:#a6e22e">+       return (self.x1 &lt;= other.x2 and self.x2 &gt;= other.x1 and
</span><span style="color:#a6e22e">+               self.y1 &lt;= other.y2 and self.y2 &gt;= other.y1)
</span></code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>class Rect:
    def __init__(self, x, y, w, h):
        self.x1 = x
        self.y1 = y
        self.x2 = x + w
        self.y2 = y + h

    <span class="new-text">def center(self):
        center_x = int((self.x1 + self.x2) / 2)
        center_y = int((self.y1 + self.y2) / 2)
        return (center_x, center_y)

    def intersect(self, other):
        # returns true if this rectangle intersects with another one
        return (self.x1 <= other.x2 and self.x2 >= other.x1 and
                self.y1 <= other.y2 and self.y2 >= other.y1)</span></pre>

</div>

</div>

<script src="/js/codetabs.js"></script>
<p>Don&rsquo;t worry too much about the specifics here. Just know that the
&lsquo;center&rsquo; method gives us the center point of a rectangle, and that
&lsquo;intersect&rsquo; tells us if two rectangles overlap.</p>
<p>We&rsquo;re going to need a few variables to set the maximum and minimum size
of the rooms, along with the maximum number of rooms one floor can have.
Add the following to <code>engine.py</code></p>
<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

   <div class="data-pane active" data-pane="diff">
   <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">    ...
    map_height = 45

<span style="color:#a6e22e">+   room_max_size = 10
</span><span style="color:#a6e22e">+   room_min_size = 6
</span><span style="color:#a6e22e">+   max_rooms = 30
</span><span style="color:#a6e22e"></span>
    colors = {
    ...
</code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>    ...
    map_height = 45

    <span class="new-text">room_max_size = 10
    room_min_size = 6
    max_rooms = 30</span>

    colors = {
    ...</pre>

</div>

</div>

<script src="/js/codetabs.js"></script>
<p>At long last, it&rsquo;s time to modify <code>make_map</code> to generate our dungeon!
You can completely remove our old implementation and replace it with the
following:</p>
<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

   <div class="data-pane active" data-pane="diff">
   <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff"><span style="color:#f92672">-   def make_map(self):
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+   def make_map(self, max_rooms, room_min_size, room_max_size, map_width, map_height, player):
</span><span style="color:#a6e22e"></span><span style="color:#f92672">-       room1 = Rect(20, 15, 10, 15)
</span><span style="color:#f92672">-       room2 = Rect(35, 15, 10, 15)
</span><span style="color:#f92672"></span>
<span style="color:#f92672">-       self.create_room(room1)
</span><span style="color:#f92672">-       self.create_room(room2)
</span><span style="color:#f92672"></span>
<span style="color:#f92672">-       self.create_h_tunnel(25, 40, 23)
</span><span style="color:#f92672"></span>
<span style="color:#a6e22e">+       rooms = []
</span><span style="color:#a6e22e">+       num_rooms = 0
</span><span style="color:#a6e22e">+
</span><span style="color:#a6e22e">+       for r in range(max_rooms):
</span><span style="color:#a6e22e">+           # random width and height
</span><span style="color:#a6e22e">+           w = randint(room_min_size, room_max_size)
</span><span style="color:#a6e22e">+           h = randint(room_min_size, room_max_size)
</span><span style="color:#a6e22e">+           # random position without going out of the boundaries of the map
</span><span style="color:#a6e22e">+           x = randint(0, map_width - w - 1)
</span><span style="color:#a6e22e">+           y = randint(0, map_height - h - 1)
</span></code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>    <span class="crossed-out-text">def make_map(self):</span>
    <span class="new-text">def make_map(self, max_rooms, room_min_size, room_max_size, map_width, map_height, player):</span>
        <span class="crossed-out-text">room1 = Rect(20, 15, 10, 15)</span>
        <span class="crossed-out-text">room2 = Rect(35, 15, 10, 15)</span>

        <span class="crossed-out-text">self.create_room(room1)</span>
        <span class="crossed-out-text">self.create_room(room2)</span>

        <span class="crossed-out-text">self.create_h_tunnel(25, 40, 23)</span>

        <span class="new-text">rooms = []
        num_rooms = 0

        for r in range(max_rooms):
            # random width and height
            w = randint(room_min_size, room_max_size)
            h = randint(room_min_size, room_max_size)
            # random position without going out of the boundaries of the map
            x = randint(0, map_width - w - 1)
            y = randint(0, map_height - h - 1)</span></pre>

</div>

</div>

<script src="/js/codetabs.js"></script>
<p>The variables we&rsquo;re creating here will be what we use to create our
rooms momentarily. <code>randint</code> gives us a random integer between the
values we specify. In this case, we want our width and height to be
between our given minimums and maximums, and our x and y should be
within the boundaries of the map.</p>
<p>We also need to import <code>randint</code> from <code>random</code> at the top of the file.
Your import section for <code>game_map.py</code> should now look something like
this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3"><span style="color:#f92672">from</span> random <span style="color:#f92672">import</span> randint

<span style="color:#f92672">from</span> map_objects.rectangle <span style="color:#f92672">import</span> Rect
<span style="color:#f92672">from</span> map_objects.tile <span style="color:#f92672">import</span> Tile</code></pre></div>
<p>Last thing before we proceed: We need to update the call to <code>make_map</code>
in <code>engine.py</code>, because now we&rsquo;re asking for a bunch of variables that
we weren&rsquo;t before. Modify it to look like this:</p>
<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

   <div class="data-pane active" data-pane="diff">
   <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">    ...
    game_map = GameMap(map_width, map_height)
<span style="color:#f92672">-   game_map.make_map()
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+   game_map.make_map(max_rooms, room_min_size, room_max_size, map_width, map_height, player)
</span></code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>    ...
    game_map = GameMap(map_width, map_height)
    <span class="crossed-out-text">game_map.make_map()</span>
    <span class="new-text">game_map.make_map(max_rooms, room_min_size, room_max_size, map_width, map_height, player)</span></pre>

</div>

</div>

<script src="/js/codetabs.js"></script>
<p>Now we&rsquo;ll put our <code>Rect</code> class to use, by passing it the variables we
just created. Then, we can check if it intersects with any other rooms.
If it does, we don&rsquo;t want to add it to our rooms, and we simply toss it
out.</p>
<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

   <div class="data-pane active" data-pane="diff">
   <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">            ...
            y = randint(0, map_height - h - 1)

<span style="color:#a6e22e">+           # &#34;Rect&#34; class makes rectangles easier to work with
</span><span style="color:#a6e22e">+           new_room = Rect(x, y, w, h)
</span><span style="color:#a6e22e">+
</span><span style="color:#a6e22e">+           # run through the other rooms and see if they intersect with this one
</span><span style="color:#a6e22e">+           for other_room in rooms:
</span><span style="color:#a6e22e">+               if new_room.intersect(other_room):
</span><span style="color:#a6e22e">+                   break
</span></code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>            ...
            y = randint(0, map_height - h - 1)

            <span class="new-text"># "Rect" class makes rectangles easier to work with
            new_room = Rect(x, y, w, h)

            # run through the other rooms and see if they intersect with this one
            for other_room in rooms:
                if new_room.intersect(other_room):
                    break</span></pre>

</div>

</div>

<script src="/js/codetabs.js"></script>
<p>If the room does <em>not</em> intersect any others, then we&rsquo;ll need to create
it. Rather than introducing a boolean (True/False value) to keep track
of whether or not we intersected, we can simply use a for-else
statement! This is a unique, lesser known Python technique, which
basically says &ldquo;if the for loop did not &lsquo;break&rsquo;, then do this&rdquo;. We&rsquo;ll
put our room placement code in this &lsquo;else&rsquo; statement right after the
for-loop.</p>
<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

   <div class="data-pane active" data-pane="diff">
   <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">            ...
            for other_room in rooms:
                if new_room.intersect(other_room):
                    break
<span style="color:#a6e22e">+           else:
</span><span style="color:#a6e22e">+               # this means there are no intersections, so this room is valid
</span><span style="color:#a6e22e">+
</span><span style="color:#a6e22e">+               # &#34;paint&#34; it to the map&#39;s tiles
</span><span style="color:#a6e22e">+               self.create_room(new_room)
</span><span style="color:#a6e22e">+
</span><span style="color:#a6e22e">+               # center coordinates of new room, will be useful later
</span><span style="color:#a6e22e">+               (new_x, new_y) = new_room.center()
</span><span style="color:#a6e22e">+
</span><span style="color:#a6e22e">+               if num_rooms == 0:
</span><span style="color:#a6e22e">+                   # this is the first room, where the player starts at
</span><span style="color:#a6e22e">+                   player.x = new_x
</span><span style="color:#a6e22e">+                   player.y = new_y
</span></code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>            ...
            for other_room in rooms:
                if new_room.intersect(other_room):
                    break
            <span class="new-text">else:
                # this means there are no intersections, so this room is valid

                # "paint" it to the map's tiles
                self.create_room(new_room)

                # center coordinates of new room, will be useful later
                (new_x, new_y) = new_room.center()

                if num_rooms == 0:
                    # this is the first room, where the player starts at
                    player.x = new_x
                    player.y = new_y</span></pre>

</div>

</div>

<script src="/js/codetabs.js"></script>
<p>We&rsquo;re creating our room, and saving the coordinates of its &ldquo;center&rdquo;. If
it&rsquo;s the first room we&rsquo;ve created, then we place the player right in the
middle of it. We&rsquo;ll also put these center coordinates to use in just a
moment to create our tunnels.</p>
<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

   <div class="data-pane active" data-pane="diff">
   <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">                ...
                if num_rooms == 0:
                    # this is the first room, where the player starts at
                    player.x = new_x
                    player.y = new_y
<span style="color:#a6e22e">+               else:
</span><span style="color:#a6e22e">+                   # all rooms after the first:
</span><span style="color:#a6e22e">+                   # connect it to the previous room with a tunnel
</span><span style="color:#a6e22e">+
</span><span style="color:#a6e22e">+                   # center coordinates of previous room
</span><span style="color:#a6e22e">+                   (prev_x, prev_y) = rooms[num_rooms - 1].center()
</span><span style="color:#a6e22e">+
</span><span style="color:#a6e22e">+                   # flip a coin (random number that is either 0 or 1)
</span><span style="color:#a6e22e">+                   if randint(0, 1) == 1:
</span><span style="color:#a6e22e">+                       # first move horizontally, then vertically
</span><span style="color:#a6e22e">+                       self.create_h_tunnel(prev_x, new_x, prev_y)
</span><span style="color:#a6e22e">+                       self.create_v_tunnel(prev_y, new_y, new_x)
</span><span style="color:#a6e22e">+                   else:
</span><span style="color:#a6e22e">+                       # first move vertically, then horizontally
</span><span style="color:#a6e22e">+                       self.create_v_tunnel(prev_y, new_y, prev_x)
</span><span style="color:#a6e22e">+                       self.create_h_tunnel(prev_x, new_x, new_y)
</span><span style="color:#a6e22e">+
</span><span style="color:#a6e22e">+               # finally, append the new room to the list
</span><span style="color:#a6e22e">+               rooms.append(new_room)
</span><span style="color:#a6e22e">+               num_rooms += 1
</span></code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>                ...
                if num_rooms == 0:
                    # this is the first room, where the player starts at
                    player.x = new_x
                    player.y = new_y
                <span class="new-text">else:
                    # all rooms after the first:
                    # connect it to the previous room with a tunnel

                    # center coordinates of previous room
                    (prev_x, prev_y) = rooms[num_rooms - 1].center()

                    # flip a coin (random number that is either 0 or 1)
                    if randint(0, 1) == 1:
                        # first move horizontally, then vertically
                        self.create_h_tunnel(prev_x, new_x, prev_y)
                        self.create_v_tunnel(prev_y, new_y, new_x)
                    else:
                        # first move vertically, then horizontally
                        self.create_v_tunnel(prev_y, new_y, prev_x)
                        self.create_h_tunnel(prev_x, new_x, new_y)

                # finally, append the new room to the list
                rooms.append(new_room)
                num_rooms += 1</span></pre>

</div>

</div>

<script src="/js/codetabs.js"></script>
<p>This &lsquo;else&rsquo; statement covers all cases where we&rsquo;ve already placed at
least one room. In order for our dungeon to be navigable, we need to
ensure connectivity by creating tunnels. We get the center of the
previous room, and then, based on a random choice (between one or zero,
or a coin toss if you prefer to think of it that way), we carve our
tunnels, either vertically then horizontally or vice versa. After all
that, we append the room to our &lsquo;rooms&rsquo; list, and increment the number
of rooms.</p>
<p>And that&rsquo;s it! There&rsquo;s our functioning, albeit basic, dungeon
generation algorithm. Run the project now and you should be placed in a
procedurally generated dungeon! Note that our NPC isn&rsquo;t being placed
intelligently here, so it may or may not be stuck in a wall.</p>
<p>If you want to see the code so far in its entirety, <a href="https://github.com/TStand90/roguelike_tutorial_revised/tree/part3">click
here</a>.</p>
<p><a href="/tutorials/tcod/2019/part-4">Click here to move on to the next part of this
tutorial.</a></p>
<!-- raw HTML omitted -->


    

    


</article>



        </div>

        <aside class="col-12 col-lg-3 ml-auto blog-sidebar">
    
    
        <section>
    
        
    
        
    
</section>
    
</aside>

      </div>
    </div>
    

    
      







<footer class="blog-footer w-100">
    <nav class="navbar navbar-light bg-light">
        <p class="w-100 text-center">Last updated July 7th, 2020</p>
        <p class="w-100 text-center"><a href="#">Back to top</a></p>
    </nav>
</footer>

    

    
    
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
  </body>
</html>
