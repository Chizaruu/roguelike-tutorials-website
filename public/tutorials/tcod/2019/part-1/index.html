<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta property="og:title" content="Part 1 - Drawing the &#39;@&#39; symbol and moving it around" />
<meta property="og:description" content="Welcome to part 1 of the Roguelike Tutorial Revised! This series will help you create your very first roguelike game, written in Python!
This tutorial is largely based off the one found on Roguebasin. Many of the design decisions were mainly to keep this tutorial in lockstep with that one (at least in terms of chapter composition and general direction). This tutorial would not have been possible without the guidance of those who wrote that tutorial, along with all the wonderful contributors to libtcod and python-tcod over the years." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://rogueliketutorials.com/tutorials/tcod/2019/part-1/" /><meta property="article:section" content="tutorials" />
<meta property="article:published_time" content="2019-03-30T08:39:15-07:00" />
<meta property="article:modified_time" content="2019-03-30T08:39:15-07:00" />


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Part 1 - Drawing the &#39;@&#39; symbol and moving it around"/>
<meta name="twitter:description" content="Welcome to part 1 of the Roguelike Tutorial Revised! This series will help you create your very first roguelike game, written in Python!
This tutorial is largely based off the one found on Roguebasin. Many of the design decisions were mainly to keep this tutorial in lockstep with that one (at least in terms of chapter composition and general direction). This tutorial would not have been possible without the guidance of those who wrote that tutorial, along with all the wonderful contributors to libtcod and python-tcod over the years."/>



    <link rel="canonical" href="https://rogueliketutorials.com/tutorials/tcod/2019/part-1/">

    <title>
      
        Part 1 - Drawing the &#39;@&#39; symbol and moving it around | Roguelike Tutorials
      
    </title>

    
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link href="https://rogueliketutorials.com/css/style.css" rel="stylesheet">

    

    

    
  </head>
  <body>
    
      

<header class="blog-header">
    <nav class="navbar navbar-expand-md navbar-dark bg-dark">
        <a class="navbar-brand" href="/">
            Roguelike Tutorials
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false"
            aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-between" id="navbarNav">
            <ul class="navbar-nav">
                
                
                <li class="nav-item ">
                    
                        <a class="nav-link" href="/">Home</a>
                    
                </li>
                
                <li class="nav-item ">
                    
                        <a class="nav-link" href="/tutorials/tcod/2019/">TCOD Tutorial (2019)</a>
                    
                </li>
                
                <li class="nav-item ">
                    
                        <a class="nav-link" href="/tutorials/tcod/v2/">TCOD Tutorial (2020)</a>
                    
                </li>
                
                <li class="nav-item ">
                    
                        <a class="nav-link" href="/about/">About</a>
                    
                </li>
                
            </ul>
            
        </div>
    </nav>
</header>

    

    
    <div class="container">
      <div class="row">
        <div class="col-12 col-lg-8 blog-main">

          

<header>
    <h2 class="blog-post-title">
    <a class="text-dark" href="/tutorials/tcod/2019/part-1/">Part 1 - Drawing the &lsquo;@&rsquo; symbol and moving it around</a>
</h2>

    


<div class="blog-post-date text-secondary">
    
        <time datetime="2019-03-30">Mar 30, 2019</time>
    
    
</div>

    
    
    <hr>
</header>
<article class="blog-post">
    <p>Welcome to part 1 of the <strong>Roguelike Tutorial Revised</strong>! This series
will help you create your very first roguelike game, written in Python!</p>
<p>This tutorial is largely based off the <a href="http://www.roguebasin.com/index.php?title=Complete_Roguelike_Tutorial,_using_python%2Blibtcod">one found on
Roguebasin</a>.
Many of the design decisions were mainly to keep this tutorial in lockstep
with that one (at least in terms of chapter composition and general
direction). This tutorial would not have been possible without the
guidance of those who wrote that tutorial, along with all the wonderful
contributors to libtcod and python-tcod over the years.</p>
<p>This part assumes that you have either checked <a href="/tutorials/tcod/2019/part-0">Part
0</a> and are already set up and ready to go. If
not, be sure to check that page, and make sure that you&rsquo;ve got Python
and TCOD installed, and a file called <code>engine.py</code> created in the
directory that you want to work in.</p>
<p>Assuming that you&rsquo;ve done all that, let&rsquo;s get started. Modify (or
create, if you haven&rsquo;t already) the file <code>engine.py</code> to look like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3"><span style="color:#f92672">import</span> tcod <span style="color:#66d9ef">as</span> libtcod


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>():
    print(<span style="color:#e6db74">&#39;Hello World!&#39;</span>)


<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
    main()</code></pre></div>
<p>You can run the program like any other Python program, but for those
who are brand new, you do that by typing <code>python engine.py</code> in the
terminal. If you have both Python 2 and 3 installed on your machine, you
might have to use <code>python3 engine.py</code> to run (it depends on your default
python, and whether you&rsquo;re using a virtualenv or not).</p>
<p>Okay, not the most exciting program in the world, I admit, but we&rsquo;ve
already got our first major difference from the other tutorial. Namely,
this funky looking thing here:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3"><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
    main()</code></pre></div>
<p>So what does that do? Basically, we&rsquo;re saying that we&rsquo;re only going to
run the &ldquo;main&rdquo; function when we explicitly run the script, using <code>python engine.py</code>. It&rsquo;s not super important that you understand this now, but
if you want a more detailed explanation, <a href="https://stackoverflow.com/a/419185">this answer on Stack
Overflow</a> gives a pretty good
overview.</p>
<p>Confirm that the above program runs (if not, there&rsquo;s probably an issue
with your libtcod setup). Once that&rsquo;s done, we can move on to bigger and
better things. The first major step to creating any roguelike is getting
an &lsquo;@&rsquo; character on the screen and moving, so let&rsquo;s get started with
that.</p>
<p>Modify <code>engine.py</code> to look like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3"><span style="color:#f92672">import</span> tcod <span style="color:#66d9ef">as</span> libtcod


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>():
    screen_width <span style="color:#f92672">=</span> <span style="color:#ae81ff">80</span>
    screen_height <span style="color:#f92672">=</span> <span style="color:#ae81ff">50</span>

    libtcod<span style="color:#f92672">.</span>console_set_custom_font(<span style="color:#e6db74">&#39;arial10x10.png&#39;</span>, libtcod<span style="color:#f92672">.</span>FONT_TYPE_GREYSCALE <span style="color:#f92672">|</span> libtcod<span style="color:#f92672">.</span>FONT_LAYOUT_TCOD)

    libtcod<span style="color:#f92672">.</span>console_init_root(screen_width, screen_height, <span style="color:#e6db74">&#39;libtcod tutorial revised&#39;</span>, <span style="color:#66d9ef">False</span>)

    <span style="color:#66d9ef">while</span> <span style="color:#f92672">not</span> libtcod<span style="color:#f92672">.</span>console_is_window_closed():
        libtcod<span style="color:#f92672">.</span>console_set_default_foreground(<span style="color:#ae81ff">0</span>, libtcod<span style="color:#f92672">.</span>white)
        libtcod<span style="color:#f92672">.</span>console_put_char(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;@&#39;</span>, libtcod<span style="color:#f92672">.</span>BKGND_NONE)
        libtcod<span style="color:#f92672">.</span>console_flush()

        key <span style="color:#f92672">=</span> libtcod<span style="color:#f92672">.</span>console_check_for_keypress()

        <span style="color:#66d9ef">if</span> key<span style="color:#f92672">.</span>vk <span style="color:#f92672">==</span> libtcod<span style="color:#f92672">.</span>KEY_ESCAPE:
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">True</span>


<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
    main()</code></pre></div>
<p>Run <code>engine.py</code> again, and you should see an &lsquo;@&rsquo; symbol on the screen.
Once you&rsquo;ve fully soaked in the glory on the screen in front of you, you
can hit the `Esc` key to exit the program.</p>
<p>There&rsquo;s a lot going on here, so let&rsquo;s break it down line by line.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3">    screen_width <span style="color:#f92672">=</span> <span style="color:#ae81ff">80</span>
    screen_height <span style="color:#f92672">=</span> <span style="color:#ae81ff">50</span></code></pre></div>
<p>This is simple enough. We&rsquo;re defining some variables for the screen
size. Eventually, we&rsquo;ll load these values from a JSON file rather than
hard coding them in the source, but we won&rsquo;t worry about that until we
have some more variables like
this.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3">    libtcod<span style="color:#f92672">.</span>console_set_custom_font(<span style="color:#e6db74">&#39;arial10x10.png&#39;</span>, libtcod<span style="color:#f92672">.</span>FONT_TYPE_GREYSCALE <span style="color:#f92672">|</span> libtcod<span style="color:#f92672">.</span>FONT_LAYOUT_TCOD)</code></pre></div>
<p>Here, we&rsquo;re telling libtcod which font to use. The <code>'arial10x10.png'</code>
bit is the actual file we&rsquo;re reading from (this should exist in your
project folder). The other two parts are telling libtcod which type of
file we&rsquo;re
reading.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3">    libtcod<span style="color:#f92672">.</span>console_init_root(SCREEN_WIDTH, SCREEN_HEIGHT, <span style="color:#e6db74">&#39;libtcod tutorial revised&#39;</span>, <span style="color:#66d9ef">False</span>)</code></pre></div>
<p>This line is what actually creates the screen. We&rsquo;re giving it the
<code>screen_width</code> and <code>screen_height</code> values from before (80 and 50,
respectively), along with a title (change this if you&rsquo;ve already got
your game&rsquo;s name figured out), and a boolean value that tells libtcod
whether to go full screen or not.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3">    <span style="color:#66d9ef">while</span> <span style="color:#f92672">not</span> libtcod<span style="color:#f92672">.</span>console_is_window_closed():</code></pre></div>
<p>This is what&rsquo;s called our &lsquo;game loop&rsquo;. Basically, this is a loop that
won&rsquo;t ever end, until we close the screen. Every game has some sort of
game loop or another.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3">        libtcod<span style="color:#f92672">.</span>console_set_default_foreground(<span style="color:#ae81ff">0</span>, libtcod<span style="color:#f92672">.</span>white)</code></pre></div>
<p>This line tells libtcod to set the color for our &lsquo;@&rsquo; symbol. If you want
your character to be a different color, change <code>libtcod.white</code> to
something like <code>libtcod.red</code> and see what happens. The &lsquo;0&rsquo; in this
function is the console we&rsquo;re drawing to. We&rsquo;ll go over that more later.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3">        libtcod<span style="color:#f92672">.</span>console_put_char(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;@&#39;</span>, libtcod<span style="color:#f92672">.</span>BKGND_NONE)</code></pre></div>
<p>The first argument is &lsquo;0&rsquo; (again, the console we&rsquo;re printing to). The
next two are x and y coordinates, in this case, 1 and 1 (try changing
that and see what happens). Next, we&rsquo;re printing the &lsquo;@&rsquo; symbol, and
setting the background to &lsquo;none&rsquo; with <code>libtcod.BKGND_NONE</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3">        libtcod<span style="color:#f92672">.</span>console_flush()</code></pre></div>
<p>This is the part that presents everything on the screen. Pretty
straightforward.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3">        key <span style="color:#f92672">=</span> libtcod<span style="color:#f92672">.</span>console_check_for_keypress()

        <span style="color:#66d9ef">if</span> key<span style="color:#f92672">.</span>vk <span style="color:#f92672">==</span> libtcod<span style="color:#f92672">.</span>KEY_ESCAPE:
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">True</span></code></pre></div>
<p>This part gives us a way to gracefully exit (i.e. not crashing) the
program by hitting the <code>Esc</code> key. The
<code>libtcod.console_check_for_keypress()</code> function gets any keyboard input
to the program, which we store in the <code>key</code> variable. From there, we
check if the key pressed was the <code>Esc</code> key or not. If it was, then we
exit the loop, thus ending the program.</p>
<p>So we&rsquo;ve got our &lsquo;@&rsquo; symbol drawn, now let&rsquo;s get it moving around!</p>
<p>We need to keep track of the player&rsquo;s position at all times, so let&rsquo;s
create two variables, <code>player_x</code> and <code>player_y</code> to keep track of this.</p>
<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

  
<div class="data-pane active" data-pane="diff">
  
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">    ...
    screen_height = 50
<span style="color:#a6e22e">+
</span><span style="color:#a6e22e">+   player_x = int(screen_width / 2)
</span><span style="color:#a6e22e">+   player_y = int(screen_height / 2)
</span><span style="color:#a6e22e">+
</span><span style="color:#a6e22e"></span>    libtcod.console_set_custom_font(&#39;arial10x10.png&#39;, libtcod.FONT_TYPE_GREYSCALE | libtcod.FONT_LAYOUT_TCOD)
    ...
</code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>    ...
    screen_height = 50
    <span class="new-text">
    player_x = int(screen_width / 2)
    player_y = int(screen_height / 2)
    </span>
    libtcod.console_set_custom_font('arial10x10.png', libtcod.FONT_TYPE_GREYSCALE | libtcod.FONT_LAYOUT_TCOD)
    ...</pre>

</div>

</div>

<script src="/js/codetabs.js"></script>
<p><em>Note: Ellipses denote omitted parts of the code. I&rsquo;ll include lines
around the code to be inserted so that you&rsquo;ll know exactly where to put
new pieces of code, but I won&rsquo;t be showing the entire file every time.
The green lines denote code that you should be adding.</em></p>
<p>We&rsquo;re placing the player right in the middle of the screen. What&rsquo;s with
the <code>int()</code> function though? Well, Python 3 doesn&rsquo;t automatically
truncate division like Python 2 does, so we have to cast the division
result (a float) to an integer. If we don&rsquo;t, libtcod will give an error.</p>
<p>We also have to modify the command to put the &lsquo;@&rsquo; symbol to use these
new coordinates.</p>
<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

  
<div class="data-pane active" data-pane="diff">
  
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">        ...
        libtcod.console_set_default_foreground(0, libtcod.white)
<span style="color:#f92672">-       libtcod.console_put_char(0, 1, 1, &#39;@&#39;, libtcod.BKGND_NONE)
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+       libtcod.console_put_char(0, player_x, player_y, &#39;@&#39;, libtcod.BKGND_NONE)
</span><span style="color:#a6e22e"></span>        libtcod.console_flush()

<span style="color:#a6e22e">+       libtcod.console_put_char(0, player_x, player_y, &#39; &#39;, libtcod.BKGND_NONE)
</span><span style="color:#a6e22e"></span>        ...
</code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>        ...
        libtcod.console_set_default_foreground(0, libtcod.white)
        <span class="crossed-out-text">libtcod.console_put_char(0, 1, 1, '@', libtcod.BKGND_NONE)</span>
        <span class="new-text">libtcod.console_put_char(0, player_x, player_y, '@', libtcod.BKGND_NONE)</span>
        libtcod.console_flush()

        <span class="new-text">libtcod.console_put_char(0, player_x, player_y, ' ', libtcod.BKGND_NONE)</span>
        ...</pre>

</div>

</div>

<script src="/js/codetabs.js"></script>
<p><em>Note: The red lines denote code that has been removed.</em></p>
<p>Run the code now and you should see the &lsquo;@&rsquo; in the center of the screen.
Let&rsquo;s take care of moving it around now.</p>
<p>Put the following two lines right above the main game loop.</p>
<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

  
<div class="data-pane active" data-pane="diff">
  
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">    ...
    libtcod.console_init_root(screen_width, screen_height, &#39;libtcod tutorial revised&#39;, False)

<span style="color:#a6e22e">+   key = libtcod.Key()
</span><span style="color:#a6e22e">+   mouse = libtcod.Mouse()
</span><span style="color:#a6e22e"></span>
    while not libtcod.console_is_window_closed():
    ...
</code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>    ...
    libtcod.console_init_root(screen_width, screen_height, 'libtcod tutorial revised', False)

    <span class="new-text">key = libtcod.Key()
    mouse = libtcod.Mouse()</span>

    while not libtcod.console_is_window_closed():
    ...</pre>

</div>

</div>

<script src="/js/codetabs.js"></script>
<p>As the names imply, these variables will hold our keyboard and mouse
input. We aren&rsquo;t implementing the mouse yet, but the function we&rsquo;re
about to add take it into account, so we might as well add it.</p>
<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

  
<div class="data-pane active" data-pane="diff">
  
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">    ...
    while not libtcod.console_is_window_closed():
<span style="color:#a6e22e">+       libtcod.sys_check_for_event(libtcod.EVENT_KEY_PRESS, key, mouse)
</span><span style="color:#a6e22e"></span>
        libtcod.console_set_default_foreground(0, libtcod.white)
    ...
</code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>    ...
    while not libtcod.console_is_window_closed():
        <span class="new-text">libtcod.sys_check_for_event(libtcod.EVENT_KEY_PRESS, key, mouse)</span>

        libtcod.console_set_default_foreground(0, libtcod.white)
    ...</pre>

</div>

</div>

<script src="/js/codetabs.js"></script>
<p>This is the function that actually captures new &ldquo;events&rdquo; (user input).
It will update the <code>key</code> and <code>mouse</code> variables with what the user
inputs. Again, we&rsquo;re only concerned with <code>key</code> for right now.</p>
<p>Okay, so we&rsquo;re updating the <code>key</code> variable with the user&rsquo;s input. But
what do we actually <em>do</em> with it? Let&rsquo;s define a function to handle the
user&rsquo;s input. It will essentially translate the user&rsquo;s key presses into
game actions.</p>
<p>Up until now, this tutorial hasn&rsquo;t deviated all that much from the
original one, but here&rsquo;s a critical turning point. We&rsquo;re about to define
a function, called <code>handle_keys</code> to take care of keyboard input. We
<em>could</em> put this in our <code>engine.py</code> file&hellip; but should it be there? I
would argue no. The engine (game loop) captures input and should do
something with it; but, translating from one to the other is not
something it needs to know about.</p>
<p>So rather than putting the <code>handle_keys</code> function in <code>engine.py</code>, let&rsquo;s
create a new file, called <code>input_handlers.py</code>. Put the following code
inside that new file.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3"><span style="color:#f92672">import</span> tcod <span style="color:#66d9ef">as</span> libtcod


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">handle_keys</span>(key):
    <span style="color:#75715e"># Movement keys</span>
    <span style="color:#66d9ef">if</span> key<span style="color:#f92672">.</span>vk <span style="color:#f92672">==</span> libtcod<span style="color:#f92672">.</span>KEY_UP:
        <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#39;move&#39;</span>: (<span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)}
    <span style="color:#66d9ef">elif</span> key<span style="color:#f92672">.</span>vk <span style="color:#f92672">==</span> libtcod<span style="color:#f92672">.</span>KEY_DOWN:
        <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#39;move&#39;</span>: (<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>)}
    <span style="color:#66d9ef">elif</span> key<span style="color:#f92672">.</span>vk <span style="color:#f92672">==</span> libtcod<span style="color:#f92672">.</span>KEY_LEFT:
        <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#39;move&#39;</span>: (<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>)}
    <span style="color:#66d9ef">elif</span> key<span style="color:#f92672">.</span>vk <span style="color:#f92672">==</span> libtcod<span style="color:#f92672">.</span>KEY_RIGHT:
        <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#39;move&#39;</span>: (<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>)}

    <span style="color:#66d9ef">if</span> key<span style="color:#f92672">.</span>vk <span style="color:#f92672">==</span> libtcod<span style="color:#f92672">.</span>KEY_ENTER <span style="color:#f92672">and</span> key<span style="color:#f92672">.</span>lalt:
        <span style="color:#75715e"># Alt+Enter: toggle full screen</span>
        <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#39;fullscreen&#39;</span>: <span style="color:#66d9ef">True</span>}

    <span style="color:#66d9ef">elif</span> key<span style="color:#f92672">.</span>vk <span style="color:#f92672">==</span> libtcod<span style="color:#f92672">.</span>KEY_ESCAPE:
        <span style="color:#75715e"># Exit the game</span>
        <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#39;exit&#39;</span>: <span style="color:#66d9ef">True</span>}

    <span style="color:#75715e"># No key was pressed</span>
    <span style="color:#66d9ef">return</span> {}</code></pre></div>
<p>That&rsquo;s a lot to take in all at once, so again, let&rsquo;s break it down a
bit.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">handle_keys</span>(key):</code></pre></div>
<p>We&rsquo;re defining a function called <code>handle_keys</code>, which takes one
argument, <code>key</code>. <code>key</code> in this case will be the key variable we captured
earlier.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3">    <span style="color:#66d9ef">if</span> key<span style="color:#f92672">.</span>vk <span style="color:#f92672">==</span> libtcod<span style="color:#f92672">.</span>KEY_UP:</code></pre></div>
<p>This if statement (along with the other elifs) just tell us which key
was pressed. Right now, it&rsquo;s one of the arrow keys for movement. What&rsquo;s
more interesting is the code inside these if statements</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3">    <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#39;move&#39;</span>: (<span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)}</code></pre></div>
<p>So what&rsquo;s going on here? Well, when we return from this function, the
engine is going to have to do something. In this case, we want our
character to move. But what if we hit a different key? Then we might not
be moving; we may be using an item, casting a spell, or exiting the
game. One way to handle all these different possibilities is to return a
dictionary from this function, which the engine will read and decide
what to do.</p>
<p>In this instance, we&rsquo;re returning a dictionary with the key <code>'move'</code>,
and the value is a pair of numbers. The numbers will tell the engine in
what direction to move the player. So for example, the &lsquo;up&rsquo; key will
move us &lsquo;0&rsquo; on the x axis, and &lsquo;-1&rsquo; on the y axis.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3">    <span style="color:#66d9ef">if</span> key<span style="color:#f92672">.</span>vk <span style="color:#f92672">==</span> libtcod<span style="color:#f92672">.</span>KEY_ENTER <span style="color:#f92672">and</span> key<span style="color:#f92672">.</span>lalt:
        <span style="color:#75715e"># Alt+Enter: toggle full screen</span>
        <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#39;fullscreen&#39;</span>: <span style="color:#66d9ef">True</span>}
    <span style="color:#66d9ef">elif</span> key<span style="color:#f92672">.</span>vk <span style="color:#f92672">==</span> libtcod<span style="color:#f92672">.</span>KEY_ESCAPE:
        <span style="color:#75715e"># Exit the game</span>
        <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#39;exit&#39;</span>: <span style="color:#66d9ef">True</span>}</code></pre></div>
<p>These are our non-movement actions that we&rsquo;re allowing for now. If the
user pressed ALT+Enter, the game will go full screen. If the user
presses &lsquo;Esc&rsquo;, the game will exit.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py3" data-lang="py3">    <span style="color:#66d9ef">return</span> {}</code></pre></div>
<p>Because our engine will be expecting a dictionary, we have to return
<em>something</em>, even if nothing happened.</p>
<p>This may seem confusing, but it will likely make sense in a minute.
Let&rsquo;s return to our <code>engine.py</code> file and call our <code>handle_keys</code>
function.</p>
<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

  
<div class="data-pane active" data-pane="diff">
  
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">        ...
        libtcod.console_flush()

<span style="color:#f92672">-       key = libtcod.console_check_for_keypress()
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+       action = handle_keys(key)
</span><span style="color:#a6e22e">+
</span><span style="color:#a6e22e">+       move = action.get(&#39;move&#39;)
</span><span style="color:#a6e22e">+       exit = action.get(&#39;exit&#39;)
</span><span style="color:#a6e22e">+       fullscreen = action.get(&#39;fullscreen&#39;)
</span><span style="color:#a6e22e"></span>
<span style="color:#a6e22e">+       if move:
</span><span style="color:#a6e22e">+           dx, dy = move
</span><span style="color:#a6e22e">+           player_x += dx
</span><span style="color:#a6e22e">+           player_y += dy
</span><span style="color:#a6e22e"></span>
<span style="color:#f92672">-       if key.vk == libtcod.KEY_ESCAPE:
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+       if exit:
</span><span style="color:#a6e22e">+           return True
</span><span style="color:#a6e22e">+
</span><span style="color:#a6e22e">+       if fullscreen:
</span><span style="color:#a6e22e">+           libtcod.console_set_fullscreen(not libtcod.console_is_fullscreen())
</span><span style="color:#a6e22e"></span>        ...
</code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>        ...
        libtcod.console_flush()

        <span class="crossed-out-text">key = libtcod.console_check_for_keypress()</span>
        <span class="new-text">action = handle_keys(key)

        move = action.get('move')
        exit = action.get('exit')
        fullscreen = action.get('fullscreen')</span>

        <span class="new-text">if move:
            dx, dy = move
            player_x += dx
            player_y += dy</span>

        <span class="crossed-out-text">if key.vk == libtcod.KEY_ESCAPE:</span>
        <span class="new-text">if exit:
            return True

        if fullscreen:
            libtcod.console_set_fullscreen(not libtcod.console_is_fullscreen())</span>
        ...</pre>

</div>

</div>

<script src="/js/codetabs.js"></script>
<p>Note: I&rsquo;ll denote lines to delete in red. So in this case, remove the
<code>key = libtcod.console_check_for_keypress()</code> and <code>if key.vk == libtcod.KEY_ESCAPE</code> lines.</p>
<p>Also be sure to import the <code>handle_keys</code> function at the top of
<code>engine.py</code>.</p>
<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

  
<div class="data-pane active" data-pane="diff">
  
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">import tcod as libtcod

<span style="color:#a6e22e">+from input_handlers import handle_keys
</span></code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
    <pre>import tcod as libtcod

<span class="new-text">from input_handlers import handle_keys</span></pre>

</div>

</div>

<script src="/js/codetabs.js"></script>
<p>Hopefully now the dictionary madness in <code>handle_keys</code> makes a little
more sense. We&rsquo;re capturing the return value of <code>handle_keys</code> in the
variable <code>action</code> (which should be a dictionary, no matter what we
pressed), and checking what keys are inside it. If it contains a key
called &lsquo;move&rsquo;, then we know to look for the (x, y) coordinates. If it
contains &lsquo;exit&rsquo;, then we know we need to exit the game.</p>
<p>Try running the engine.py file now. You should be able to move around.
Exciting!</p>
<p>One last thing before we move on. Take a look at our drawing functions.
Notice how the first argument is &lsquo;0&rsquo;? In truth, that represents the
current &lsquo;console&rsquo; we are drawing to, 0 is the default. Rather than just
drawing to the default we&rsquo;ll want to specify which console to draw to,
after initiating a new one. The reasoning is that it will make it easier
to make new consoles and draw to them in the future. This will be
especially useful when we get to the GUI portion of this series.</p>
<p>Modify the <code>engine.py</code> file like this:</p>
<div>
  <button class="btn btn-primary data-toggle-tab active" data-toggle-tab="diff">
    Diff
  </button>
  <button class="btn btn-secondary data-toggle-tab" data-toggle-tab="original">
    Original
  </button>

  
<div class="data-pane active" data-pane="diff">
  
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff">    ...
    libtcod.console_init_root(screen_width, screen_height, &#39;libtcod tutorial revised&#39;, False)

<span style="color:#a6e22e">+   con = libtcod.console_new(screen_width, screen_height)
</span><span style="color:#a6e22e"></span>
    key = libtcod.Key()
    mouse = libtcod.Mouse()

    while not libtcod.console_is_window_closed():
        libtcod.sys_check_for_event(libtcod.EVENT_KEY_PRESS, key, mouse)
<span style="color:#a6e22e">+
</span><span style="color:#a6e22e">+       libtcod.console_set_default_foreground(con, libtcod.white)
</span><span style="color:#a6e22e">+       libtcod.console_put_char(con, player_x, player_y, &#39;@&#39;, libtcod.BKGND_NONE)
</span><span style="color:#a6e22e">+       libtcod.console_blit(con, 0, 0, screen_width, screen_height, 0, 0, 0)
</span><span style="color:#a6e22e"></span><span style="color:#f92672">-       libtcod.console_set_default_foreground(0, libtcod.white)
</span><span style="color:#f92672">-       libtcod.console_put_char(0, player_x, player_y, &#39;@&#39;, libtcod.BKGND_NONE)
</span><span style="color:#f92672"></span>        libtcod.console_flush()
<span style="color:#a6e22e">+
</span><span style="color:#a6e22e">+       libtcod.console_put_char(con, player_x, player_y, &#39; &#39;, libtcod.BKGND_NONE)
</span><span style="color:#a6e22e"></span><span style="color:#f92672">-       libtcod.console_put_char(0, player_x, player_y, &#39; &#39;, libtcod.BKGND_NONE)
</span></code></pre></div>

</div>
<div class="data-pane" data-pane="original">
  
<pre>    ...
    libtcod.console_init_root(screen_width, screen_height, 'libtcod tutorial revised', False)

    <span class="new-text">con = libtcod.console_new(screen_width, screen_height)</span>

    key = libtcod.Key()
    mouse = libtcod.Mouse()

    while not libtcod.console_is_window_closed():
        libtcod.sys_check_for_event(libtcod.EVENT_KEY_PRESS, key, mouse)
        <span class="new-text">
        libtcod.console_set_default_foreground(con, libtcod.white)
        libtcod.console_put_char(con, player_x, player_y, '@', libtcod.BKGND_NONE)
        libtcod.console_blit(con, 0, 0, screen_width, screen_height, 0, 0, 0)</span>
        <span class="crossed-out-text">libtcod.console_set_default_foreground(0, libtcod.white)</span>
        <span class="crossed-out-text">libtcod.console_put_char(0, player_x, player_y, '@', libtcod.BKGND_NONE)</span>
        libtcod.console_flush()
        <span class="new-text">
        libtcod.console_put_char(con, player_x, player_y, ' ', libtcod.BKGND_NONE)</span>
        <span class="crossed-out-text">libtcod.console_put_char(0, player_x, player_y, ' ', libtcod.BKGND_NONE)</span></pre>

</div>

</div>

<script src="/js/codetabs.js"></script>
<p><code>libtcod.console_blit</code> is used to copy <code>con</code> to libtcod&rsquo;s root console
which is then presented by <code>libtcod.console_flush</code>.</p>
<p>That wraps up part one of this tutorial! If you&rsquo;re using git or some
other form of version control (and I recommend you do), commit your
changes now.</p>
<p>If you want to see the code so far in its entirety, <a href="https://github.com/TStand90/roguelike_tutorial_revised/tree/part1">click
here</a>.
The files you&rsquo;ll want to check are <code>engine.py</code> and <code>input_handlers.py</code></p>
<p><a href="/tutorials/tcod/2019/part-2">Click here to move on to the next part of this
tutorial.</a></p>
<!-- raw HTML omitted -->


    

    


</article>



        </div>

        <aside class="col-12 col-lg-3 ml-auto blog-sidebar">
    
    
        <section>
    
        
    
        
    
</section>
    
</aside>

      </div>
    </div>
    

    
      







<footer class="blog-footer w-100">
    <nav class="navbar navbar-light bg-light">
        <p class="w-100 text-center">Last updated July 7th, 2020</p>
        <p class="w-100 text-center"><a href="#">Back to top</a></p>
    </nav>
</footer>

    

    
    
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
  </body>
</html>
